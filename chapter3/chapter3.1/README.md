# 3.1 트랜스포트 계층 서비스 및 개요

- 트랜스 포트 계층 프로토콜은 각기 다른 호스트에서 동작하는 어플리케이션 프로세스 간의 논리적 통신을 제공
- 논리적 통신은 어플리케이션의 관점에서 보면 프로세스들이 동작하는 호스트들이 직접 연결된 것처럼 보인다.
- 트랜스포트 계층 프로토콜은 네트워크 라우터가 아닌 종단 시스템에서 구현
- 트랜스포트 계층에서는 어플리케이션 프로세스로부터 받은 메시지를 작은 조각으로 분할하여 트랜스포트 계층 헤더를 추가함으로써 세그먼트를 만들어 수행한다.
- 그럼 수신 측 네트워크 계층에서 데이터그램으로부터 트랜스포트 계층 세그먼트를 추출하고 트랜스포트 계층으로 세그먼트를 보내고 트랜스포트 계층에서는 이것을 처리하여 어플리케이션에게 전달한다.

## 트랜스포트 계층과 네트워크 계층 사이의 관계

- 트랜스포트 계층은 각기 다른 호스트에서 동작하는 프로세스들 사이의 논리적 통신을 제공하지만, 네트워크 계층은 호스트들 사이의 논리적 통신을 제공한다.

이것을 간단히 비유를 해서 표현을 해보자

두 집이 존재하고 각각의 집에 자식이 12명씩 있다고 해보자. 서로 아이들이 편지를 써서 우편 서비스를 통해 배달된다고 했을 때 서로 다른 집으로 144통을 보내게 된다. 그리고 각각의 집에는 우편을 수거하고 우편을 받으면 나눠주는 역할을 하는 아이(앤과 빌)가 있다고 하자. 여기서 우편 서비스는 두 집 간에 논리적 통신을 제공한다. 반면 수거하고 나눠주는 역할을 하는 아이는 자식들 사이에서 논리적 통신을 제공한다.

- 애플리케이션 메시지 = 봉투 안의 편지
- 프로세스 = 사촌 형제
- 호스트 = 집
- 트랜스포트 계층 프로토콜 = 앤과 빌
- 네트워크 계층 프로토콜 = 우편 서비스

앤과 빌은 중간 우편센터에서 우편물을 분류하거나 한 우편센터에서 다른 우편센터로 우편물을 운반하는 작업을 하지 않는다. 우편 서비스 또한 집에서 우편물을 나눠주는 역할에 참여하지 않는다. 대신 앤과 빌 즉 트랜스포트 계층은 하위 네트워크 프로토콜이 상응하는 서비스를 제공하지 못할 때도 특정 서비스가 트랜스포트 프로토콜에 의해 제공될 수 있다. 예를 들어, 패킷을 분실하거나 손상시키거나 복사본을 만들 때도, 애플리케이션에게 신뢰적인 데이터 전송 서비스를 제공할 수 있다. 물론 그렇지 않은 경우들도 존재한다. 트랜스포트 프로토콜은 메시지에 대한 지연 보장이나 대역폭을 제공할 수 없다. 이것에 대한 역할은 아래 계층이 가지는 것이다.

## 인터넷 트랜스포트 계층의 개요

트랜스포트 계층 프로토콜은 두 개의 프로토콜을 제공하는데 하나는 비신뢰적이고 비연결형인 서비스를 요청한 애플리케이션에게 제공하는 UDP(User Datagram Protocol), 다른 하나는 신뢰적이고 연결지향형 서비스를 요청한 애플리케이션에게 제공하는 TCP(Transmission Control Protocol)이다.

일반적으로 트랜스포트 계층의 패킷을 세그먼트라고 말하지만 UDP에서는 패킷을 데이터그램으로 표현하기도 한다. 이점을 주의하라

먼저 TCP,UDP 설명 전 간단한 용어를 정리해본다.

- IP: 네트워크 계층 프로토콜은 인터넷 프로토콜이라는 이름을 가진다.
- 최선형 전달 서비스(best effoty delivery service): IP 서비스 모델이 가지는 호스트들 간에 논리적 통신을 제공
    - 이것은 IP가 통신하는 호스트들 간에 세그먼트를 전달하기 위해 최대한 노력하지만, 어떤 보장도 하지 않는다는 것을 의미
    - IP는 세그먼트의 전달을 보장하지 않고 세그먼트가 순서대로 전달되는 것을 보장하지 않는다.
    - 그렇기에 IP를 비신뢰적인 서비스라고 부른다.

UDP와 TCP의 가장 기본적인 기능은 종단 시스템 사이의 IP 전달 서비스를 종단 시스템에서 동작하는 두 프로세스 간의 전달 서비스로 확장하는 것. ‘호스트 대 호스트 전달’을 ‘프로세스 대 프로세스 전달’로 확장한느 것을 틀내스포트 계층 다중화(multiplexing)와 역다중화(demultiplexing)이라고 한다.

또한 TCP와 UDP는 헤더에 오류 검출 필드를 포함함으로써 무결성 검사를 제공한다.(추가적으로 알아본 결과 checksum을 통해서 검사를 하는데 일반적으로는 커널에서 검사를 한다. 하지만  최근에는 checksum offload 기술을 사용하기 때문에, 커널이 직접 TCP checksum을 계산하지 않고 대신 NIC가 checksum을 계산). 이정도의 기능을 담고 있는 것이 UDP가 제공하는 유일한 두 가지 서비스다. UDP는 IP와 마찬가지로 비신뢰적 서비스이다.

반면, TCP는 신뢰적인 데이터 전송을 제공한다. 흐름 제어, 순서 번호, 확인 응답, 타이머를 사용함으로써 TCP는 송신하는 프로세스로부터 수신하는 프로세스에게 데이터가 순서대로 정확하게 전달되도록 확실하게 한다. 또한 혼잡제어를 사용하여 TCP 연결이 과도한 양의 트래픽으로 모든 통신한느 호스트들 사이의 스위치와 링크를 혼잡하게 하는 것을 방지한다. 이것은 송신 측의 TCP가 네트워크에 보낼 수 있는 트래픽을 조절함으로써 수행된다.